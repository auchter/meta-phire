header:
  version: 10
env:
  MENDER_ARTIFACT_NAME: phire-rpi
local_conf_header:
  mender: |
    MENDER_STORAGE_DEVICE = "/dev/mmcblk0"
    MENDER_STORAGE_TOTAL_SIZE_MB = "30520"
    MENDER_BOOT_PART_SIZE_MB = "40"
    MENDER_DATA_PART_SIZE_MB = "24000"

    MENDER_FEATURES_ENABLE_append = " mender-uboot mender-image-sd mender-image mender-client-install mender-persist-systemd-machine-id mender-systemd mender-growfs-data"
    MENDER_FEATURES_DISABLE_append = " mender-grub mender-image-uefi"

    RPI_USE_U_BOOT = "1"

    # rpi-base.inc removes these as they are normally installed on to the
    # vfat boot partition. To be able to update the Linux kernel Mender
    # uses an image that resides on the root file system and below line
    # ensures that they are installed to /boot
    IMAGE_INSTALL_append = " kernel-image kernel-devicetree"

    # Mender will build an image called `sdimg` which shall be used instead
    # of the `rpi-sdimg`.
    IMAGE_FSTYPES_remove += " rpi-sdimg"

    # Use the same type here as specified in ARTIFACTIMG_FSTYPE to avoid
    # building an unneeded image file.
    SDIMG_ROOTFS_TYPE = "ext4"
repos:
  meta-raspberrypi:
    url: git://git.yoctoproject.org/meta-raspberrypi
    refspec: 77190af02d48adc2b28216775e6318e9eeda571c
    path: meta-raspberrypi
  meta-mender:
    layers:
      meta-mender-raspberrypi:
